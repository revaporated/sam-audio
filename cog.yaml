# Configuration for Cog ⚙️
# Reference: https://cog.run/yaml

build:
  gpu: true
  cuda: "12.1"
  python_version: "3.11"
  
  system_packages:
    - "git"
    - "ffmpeg"
    - "libsndfile1"
  
  python_packages:
    - "torch==2.7.0"  
    - "torchaudio==2.7.0"
    - "torchvision==0.22.0"
    - "torchcodec==0.3.0"
    - "torchdiffeq"
    - "transformers>=4.54.0"
    - "einops"
    - "numpy"
    - "pydub"
    - "huggingface_hub"
    - "audiobox_aesthetics"
    - "dacvae @ git+https://github.com/facebookresearch/dacvae.git"
    - "imagebind @ git+https://github.com/facebookresearch/ImageBind.git"
    - "laion-clap @ git+https://github.com/lematt1991/CLAP.git"
    - "perception-models @ git+https://github.com/facebookresearch/perception_models@unpin-deps"
  
  run:
    # Download the gated model at build time using mounted secret (using base model for faster boot)
    - command: python -c "from huggingface_hub import snapshot_download; token=open('/run/secrets/hf_token').read().strip(); snapshot_download('facebook/sam-audio-base', local_dir='/weights/sam-audio-base', token=token); print('Model downloaded successfully!')"
      mounts:
        - type: secret
          id: hf_token
          target: /run/secrets/hf_token

predict: "predict.py:Predictor"
image: "r8.im/revaporated/sam-audio"
