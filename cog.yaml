# Configuration for Cog ⚙️
# Reference: https://cog.run/yaml

build:
  gpu: true
  cuda: "12.1"
  python_version: "3.11"
  
  system_packages:
    - "git"
    - "ffmpeg"
    - "libsndfile1"
  
  python_packages:
    - "torch==2.7.0"  
    - "torchaudio==2.7.0"
    - "torchvision==0.22.0"
    - "torchcodec==0.3.0"
    - "torchdiffeq"
    - "transformers>=4.54.0"
    - "einops"
    - "numpy"
    - "pydub"
    - "huggingface_hub"
    - "audiobox_aesthetics"
    - "dacvae @ git+https://github.com/facebookresearch/dacvae.git"
    - "imagebind @ git+https://github.com/facebookresearch/ImageBind.git"
    - "laion-clap @ git+https://github.com/lematt1991/CLAP.git"
    - "perception-models @ git+https://github.com/facebookresearch/perception_models@unpin-deps"
  
  run:
    # Download the gated model at build time (HF_TOKEN must be set)
    - "python -c \"from huggingface_hub import snapshot_download; import os; snapshot_download('facebook/sam-audio-large', local_dir='/src/weights/sam-audio-large', token=os.environ.get('HF_TOKEN'))\""

predict: "predict.py:Predictor"
image: "r8.im/revaporated/sam-audio"
